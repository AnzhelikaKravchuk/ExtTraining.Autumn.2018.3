Тут бы идеально подошёл паттерн Visitor, но на то, чтобы написать его,
у меня бы ушло много времени